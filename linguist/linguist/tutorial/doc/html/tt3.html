<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><title>Translation Tutorial -  Chapter 3: Troll Print 1.0 and 1.1</title><style type="text/css"><!--
h3.fn,span.fn { margin-left: 1cm; text-indent: -1cm; }
a:link { text-decoration: none; }
body { background: white; color: black; }
--></style></head><body bgcolor="#ffffff">
<h1 align=center> Chapter 3: Troll Print 1.0 and 1.1</h1><br clear="all">
<center><img src="tt3_10_en.png"
alt="Screenshot of Troll Print 1.0 (English)"></center>
<p>
We will consider two releases of the same application: Troll Print 1.0
and 1.1.  We will learn to reuse the translations of one release for
the next release.  (In this chapter, you have to edit some source
files.  It's probably best to copy all the files to a different
directory and work there.)
<p>
Troll Print is a silly example application that lets the user choose
printer settings.  It comes in two versions: English and Portuguese.
<p>
Version 1.0 consists of these files:
<p>
<ul>
<li> <a href="tt3-printpanel-h.html">printpanel.h</a> contains the
     definition of PrintPanel;
<li> <a href="tt3-printpanel-cpp.html">printpanel.cpp</a> contains the
     implementation of PrintPanel;
<li> <a href="tt3-mainwindow-h.html">mainwindow.h</a> contains the
     definition of MainWindow;
<li> <a href="tt3-mainwindow-cpp.html">mainwindow.cpp</a> contains the
     implementation of MainWindow;
<li> <a href="tt3-main-cpp.html">main.cpp</a> contains main();
<li> <a href="tt3-tt3-pro.html">tt3.pro</a> is the <em>tmake</em>
     project file.
<li> <a href="tt3-tt3_pt-ts.html">tt3_pt.ts</a> is the Portuguese
     message file.
</ul>
<p>
<h2>Line by Line Walk-Through</h2>
<p>
<h3><a href="tt3-printpanel-h.html">printpanel.h</a></h3>   <pre>
    class PrintPanel : public QVBox
    {
        Q_OBJECT
    public:
        PrintPanel( QWidget *parent = 0, const char *name = 0 );
    };
</pre>
<p>
PrintPanel is a <a href="http://doc.trolltech.com/qwidget.html">
QWidget</a>.  It needs the Q_OBJECT macro for tr() to work properly.
<p>
<h3><a href="tt3-printpanel-cpp.html">printpanel.cpp</a></h3>    <pre>
    /*
        QLabel *lab = new QLabel( tr("&lt;b&gt;TROLL PRINT&lt;/b&gt;"), this );
        lab-&gt;setAlignment( AlignCenter );
    */
</pre>
<p>
This code is commented out in Troll Print 1.0; you will enable it
later, for Troll Print 1.1.  <pre>
        QHButtonGroup *twoSided = new QHButtonGroup( this );
        twoSided-&gt;setTitle( tr("2-sided") );
        but = new QRadioButton( tr("Enabled"), twoSided );
        but = new QRadioButton( tr("Disabled"), twoSided );
        but-&gt;toggle();
    
        QHButtonGroup *colors = new QHButtonGroup( this );
        colors-&gt;setTitle( tr("Colors") );
        but = new QRadioButton( tr("Enabled"), colors );
        but = new QRadioButton( tr("Disabled"), colors );
        but-&gt;toggle();
</pre>
<p>
Notice the two occurrences of tr("Enabled") and of tr("Disabled") in
PrintPanel.  The Qt Linguist will see that they are the same, and you
only need to translate "Enabled" once.
<p>
<h3><a href="tt3-mainwindow-h.html">mainwindow.h</a></h3>   <pre>
    class MainWindow : public QMainWindow
    {
        Q_OBJECT
    public:
        MainWindow( QWidget *parent = 0, const char *name = 0 );
    
    private slots:
        void about();
        void aboutQt();
    };
</pre>
<p>
Nothing out of the ordinary here.
<p>
<h3><a href="tt3-mainwindow-cpp.html">mainwindow.cpp</a></h3>   <pre>
    MainWindow::MainWindow( QWidget *parent, const char *name )
        : QMainWindow( parent, name )
    {
        setCaption( tr("Troll Print 1.0") );
</pre>
<p>
The window caption, being text, is of course translated using tr().  <pre>
        QPopupMenu *file = new QPopupMenu( this );
        file-&gt;insertItem( tr("E&amp;xit"), qApp, SLOT(quit()),
                           QAccel::stringToKey(tr("Ctrl+Q")) );
        QPopupMenu *help = new QPopupMenu( this );
        help-&gt;insertItem( tr("&amp;About..."), this, SLOT(about()), Key_F1 );
        help-&gt;insertItem( tr("About &amp;Qt..."), this, SLOT(aboutQt()) );
        menuBar()-&gt;insertItem( tr("&amp;File"), file );
        menuBar()-&gt;insertSeparator();
        menuBar()-&gt;insertItem( tr("&amp;Help"), help );
</pre>
<p>
The menus too are full of text that needs to be translated.
<p>
<h3><a href="tt3-main-cpp.html">main.cpp</a></h3>   <pre>
        QTranslator tor( 0 );
        tor.load( QString("tt3_") + QTextCodec::locale(), "." );
        a.installTranslator( &amp;tor );
</pre>
<p>
Troll Print will try to respect the locale.
<p>
<h2>Running Troll Print 1.0 in English and in Portuguese</h2>
<p>
This time, you won't have to type in the translations, as the file
<a href="tt3-tt3_pt-ts.html">tt3_pt.ts</a> is already provided.
<p>
Set the environment variable <tt>LANG</tt> to <tt>pt</tt>.  Try
running Troll Print now.  You should get the English version, as shown
at the top of this page.  Now run <em>lrelease</em> and try again.
You should see the Portuguese edition (Troll Imprimir 1.0):
<p>
<center><img src="tt3_10_pt_bad.png"
alt="Screenshot of Troll Imprimir 1.0 (Bad Portuguese)"></center>
<p>
Something is wrong!  In good Portuguese, the second occurrence of
"Enabled" should be "Ativadas", not "Ativado".  Same problem with
"Disabled".  If you look at
<a href="tt3-tt3_pt-ts.html">tt3_pt.ts</a> (using Qt Linguist,
maybe), you will see that there is just one occurrence of "Enabled"
and of "Disabled" in the message file, even though there are two in
the source code.
<p>
A common problem, but easily fixed.  Just go back to the source and
add a comment as second argument to tr().  In
<a href="tt3-printpanel-cpp.html">printpanel.cpp</a>, there are four
lines to change.  Add the comment "two-sided" in the appropriate tr()
calls:
<p>
<pre>
    but = new QRadioButton( tr("Enabled", "two-sided"), twoSided );
    but = new QRadioButton( tr("Disabled", "two-sided"), twoSided );
</pre>
<p>
Add the comment "colors" in the appropriate tr() calls, a few lines
later in the source code:
<p>
<pre>
    but = new QRadioButton( tr("Enabled", "colors"), colors );
    but = new QRadioButton( tr("Disabled", "colors"), colors );
</pre>
<p>
Now run <em>lupdate</em> and open tt3_pt.ts in Qt Linguist.  You
should now see two changes.
<p>
First, the message file now contains three "Enabled", "Disabled" pairs.
The first pair is marked "(obs.)"; that is, obsolete.  The second pair
has "two-sided" as comment, and the third one has "colors".  (The
comments are shown in the <em>Source text and comments</em> area of Qt
Linguist.)
<p>
Second, the translation text "Ativado" and "Desativado" is
automatically provided for the new "Enabled" and "Disabled" texts.
It's not correct, but it's a good starting point.
<p>
Now, change the right "Ativado" into "Ativadas" and "Desativado" into
"Desativadas", save and quit.  Run <em>lrelease</em> to obtain an
up-to-date binary tt3_pt.qm file, and run Troll Print (or rather Troll
Imprimir).
<p>
<center><img src="tt3_10_pt_good.png"
alt="Screenshot of Troll Imprimir 1.0 (Good Portuguese)"></center>
<p>
Comments help distinguish between two otherwise identical source
texts.  They are also useful in other cases to give clues to the
translator.  Indeed, the contexts themselves, namely MainWindow and
PrintPanel, can (and should) be commented, like this:
<pre>
    /* TRANSLATOR MainWindow
<p>
       The whole application is a MainWindow.  If you go to
       Help, About..., you will also see some text belonging to
       MainWindow.
    *&#47;
<p>
    /* TRANSLATOR PrintPanel
<p>
       The PrintPanel is the central part of the MainWindow.  It
       shows some printing options.
    *&#47;
</pre>
<p>
Try it!  Type these comments in some source files
(<a href="tt3-mainwindow-cpp.html">mainwindow.cpp</a> and
<a href="tt3-printpanel-cpp.html">printpanel.cpp</a> are appropriate
places), run <em>lupdate</em> and start Qt Linguist.  You should see
the comments in the <em>Source text and comments</em> area as you
browse through the list of translated items.
<p>
Sometimes, particularly with big programs, it can be really difficult
for the translators to see their translations and check that they're
correct.  Comments like this one help them:
<p>
<pre>
    /* TRANSLATOR ZClientErrorDialog
<p>
       In the Edit menu, choose Client Specification and pick
       the client Bartel Leendert van der Waerden.  Click on
       Profile, then choose Start Processing.  You should now
       see a window with the text "Error: Name too long!".  That
       window is a ZClientErrorDialog.
    *&#47;
</pre>
<p>
<h2>Troll Print 1.1</h2>
<p>
Let's prepare a release 1.1 of Troll Print.  Start your favorite text
editor and follow these steps:
<p>
<ul>
<li> Uncomment the two lines that create a QLabel with text
     "&lt;b&gt;TROLL PRINT&lt;/b&gt;" in
     <a href="tt3-printpanel-cpp.html">printpanel.cpp</a>.
<li> Word-crafting: Replace "2-sided" by "Two-sided" in
     <a href="tt3-printpanel-cpp.html">printpanel.cpp</a>.
<li> Replace "1.0" with "1.1" everywhere it occurs in
     <a href="tt3-mainwindow-cpp.html">mainwindow.cpp</a>.
<li> Update the copyright year to 1999-2000 in
     <a href="tt3-mainwindow-cpp.html">mainwindow.cpp</a>.
</ul>
<p>
Once finished, run <em>lupdate</em>, then open tt3_pt.ts in Qt
Linguist.  The following items are of special interest:
<p>
<ul>
<li> MainWindow
     <ul>
     <li> Troll Print 1.0 - obsolete
     <li> About Troll Print 1.0 - obsolete
     <li> Troll Print 1.0. Copyright 1999 Macroshaft, Inc. -
          obsolete
     <li> Troll Print 1.1 - automatically translated as
          "Troll Imprimir 1.1"
     <li> About Troll Print 1.1 - automatically translated as
          "Troll Imprimir 1.1"
     <li> Troll Print 1.1.  Copyright 1999-2000 Macroshaft,
          Inc. - automatically translated as "Troll Imprimir 1.1.
          Copyright 1999-2000 Macroshaft, Inc."
     </ul>
<li> PrintPanel
     <ul>
     <li> 2-sided - obsolete
     <li> &lt;b&gt;TROLL PRINT&lt;/b&gt; - untranslated
     <li> Two-sided - untranslated.
     </ul>
</ul>
<p>
Notice that <em>lupdate</em> works hard behind the scene to make
revisions easier.   Indeed, <em>lupdate</em> is quite smart about
numbers.  (Not as smart as Euler, though.)
<p>
Go over the translations in MainWindow and mark these as finished.
Translate "&lt;b&gt;TROLL PRINT&lt;/b&gt;" as "&lt;b&gt;TROLL IMPRIMIR&lt;/b&gt;".
When you're translating "Two-sided", press the "Next Guess" button to
translate "Two-sided", but change "2" into "Dois".
<p>
Save and quit, then run <em>lrelease</em>.  The Portuguese version
should look like this:
<p>
<center><img src="tt3_11_pt.png"
alt="Screenshot of Troll Imprimir 1.1 (Portuguese)"></center>
<p>
Click on "Ajuda" ("Help"), "Sobre..." ("About...").
<p>
<center><img src="tt3_11_about_pt.png"
alt="Screenshot of Troll Imprimir 1.1 (Portuguese)"></center>
<p>
Click on "Ajuda" ("Help"), "Sobre Qt..." ("About Qt...").  Oops!
That's in English.  Qt itself needs to be translated.  See
<a href="http://doc.trolltech.com/i18n.html">Internationalization with
Qt</a> for details.
<p>
Now set <tt>LANG=whatever</tt> to get the full English version:
<p>
<center><img src="tt3_11_en.png"
alt="Screenshot of Troll Print 1.1 (English)"></center>
<p>
<h2>Exercice</h2>
<p>
Write an internationalized Hangman game and give it to the
<a href="http://www.kde.org">KDE project</a>.
<p>
<h2>Further Study</h2>
<p>
Congratulations!  You are now ready to offer translated versions of
your Qt applications.
<p>
If you use <a href="http://www.trolltech.com/designer/">Qt
Designer</a>, you will be happy to know that <em>lupdate</em>
supports .ui files.  All you need is an INTERFACES line in the project
file.
<p>
Since you are among the first readers of this tutorial, please
consider
<a href="mailto:jasmin@trolltech.com?subject=Translation tutorial">
sending comments and suggestions to its maintainer</a>, in the
language of your choice.
<p>
Since you are among the first readers of this tutorial, please
consider
<a href="mailto:jasmin@trolltech.com?subject=Translation tutorial">
sending comments and suggestions to its maintainer</a>, in the
language of your choice.
<p>
[<a href="tt2.html">Previous tutorial</a>]
[<a href="tt1.html">First tutorial</a>]
[<a href="ttutorial.html">Main tutorial page</a>]

